{"ast":null,"code":"import _objectSpread from\"C:/WorkConnect/WorkConnect/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useEffect,useState}from'react';import{login as apiLogin}from'../api/auth';import{getOwnProfile as apiGetOwnProfile}from'../api/profile';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext(null);export function AuthProvider(_ref){let{children}=_ref;const[token,setToken]=useState(()=>localStorage.getItem('wc_token'));const[userId,setUserId]=useState(()=>localStorage.getItem('wc_userId'));const[profile,setProfile]=useState(()=>{try{return JSON.parse(localStorage.getItem('wc_profile'))||null;}catch(e){return null;}});useEffect(()=>{if(token){localStorage.setItem('wc_token',token);}else{localStorage.removeItem('wc_token');}},[token]);useEffect(()=>{if(userId)localStorage.setItem('wc_userId',userId);else localStorage.removeItem('wc_userId');},[userId]);useEffect(()=>{if(profile)localStorage.setItem('wc_profile',JSON.stringify(profile));else localStorage.removeItem('wc_profile');},[profile]);// login with email/password, store token and fetch profile\nconst login=async(email,password)=>{const res=await apiLogin({email,password});if(!res||!res.token)throw new Error('Login failed');setToken(res.token);setUserId(res.userId);// fetch profile and store (pass userId to support in-memory dev fallback)\ntry{const p=await apiGetOwnProfile(res.token,res.userId);setProfile(p);// return profile to caller so they can act immediately\nreturn _objectSpread(_objectSpread({},res),{},{profile:p});}catch(err){// ignore; profile can be created later\nconsole.warn('Failed to fetch profile after login',err);return res;}};// if token exists (e.g. page reload) and we don't have profile, try to fetch it\nuseEffect(()=>{let cancelled=false;async function fetchProfile(){if(!token||profile)return;try{const p=await apiGetOwnProfile(token,userId);if(!cancelled)setProfile(p);}catch(err){console.warn('Failed to fetch profile on load',err);}}fetchProfile();return()=>{cancelled=true;};},[token,userId,profile]);const logout=()=>{setToken(null);setUserId(null);setProfile(null);};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{token,userId,profile,setProfile,login,logout},children:children});}export function useAuth(){const ctx=useContext(AuthContext);if(!ctx)throw new Error('useAuth must be used inside AuthProvider');return ctx;}export default AuthContext;","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","login","apiLogin","getOwnProfile","apiGetOwnProfile","jsx","_jsx","AuthContext","AuthProvider","_ref","children","token","setToken","localStorage","getItem","userId","setUserId","profile","setProfile","JSON","parse","e","setItem","removeItem","stringify","email","password","res","Error","p","_objectSpread","err","console","warn","cancelled","fetchProfile","logout","Provider","value","useAuth","ctx"],"sources":["C:/WorkConnect/WorkConnect/frontend/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from 'react';\r\nimport { login as apiLogin } from '../api/auth';\r\nimport { getOwnProfile as apiGetOwnProfile } from '../api/profile';\r\n\r\nconst AuthContext = createContext(null);\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [token, setToken] = useState(() => localStorage.getItem('wc_token'));\r\n  const [userId, setUserId] = useState(() => localStorage.getItem('wc_userId'));\r\n  const [profile, setProfile] = useState(() => {\r\n    try {\r\n      return JSON.parse(localStorage.getItem('wc_profile')) || null;\r\n    } catch (e) {\r\n      return null;\r\n    }\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (token) {\r\n      localStorage.setItem('wc_token', token);\r\n    } else {\r\n      localStorage.removeItem('wc_token');\r\n    }\r\n  }, [token]);\r\n\r\n  useEffect(() => {\r\n    if (userId) localStorage.setItem('wc_userId', userId);\r\n    else localStorage.removeItem('wc_userId');\r\n  }, [userId]);\r\n\r\n  useEffect(() => {\r\n    if (profile) localStorage.setItem('wc_profile', JSON.stringify(profile));\r\n    else localStorage.removeItem('wc_profile');\r\n  }, [profile]);\r\n\r\n  // login with email/password, store token and fetch profile\r\n  const login = async (email, password) => {\r\n    const res = await apiLogin({ email, password });\r\n    if (!res || !res.token) throw new Error('Login failed');\r\n    setToken(res.token);\r\n    setUserId(res.userId);\r\n    // fetch profile and store (pass userId to support in-memory dev fallback)\r\n    try {\r\n      const p = await apiGetOwnProfile(res.token, res.userId);\r\n      setProfile(p);\r\n      // return profile to caller so they can act immediately\r\n      return { ...res, profile: p };\r\n    } catch (err) {\r\n      // ignore; profile can be created later\r\n      console.warn('Failed to fetch profile after login', err);\r\n      return res;\r\n    }\r\n  };\r\n\r\n  // if token exists (e.g. page reload) and we don't have profile, try to fetch it\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n    async function fetchProfile() {\r\n      if (!token || profile) return;\r\n      try {\r\n        const p = await apiGetOwnProfile(token, userId);\r\n        if (!cancelled) setProfile(p);\r\n      } catch (err) {\r\n        console.warn('Failed to fetch profile on load', err);\r\n      }\r\n    }\r\n    fetchProfile();\r\n    return () => { cancelled = true; };\r\n  }, [token, userId, profile]);\r\n\r\n  const logout = () => {\r\n    setToken(null);\r\n    setUserId(null);\r\n    setProfile(null);\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ token, userId, profile, setProfile, login, logout }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useAuth() {\r\n  const ctx = useContext(AuthContext);\r\n  if (!ctx) throw new Error('useAuth must be used inside AuthProvider');\r\n  return ctx;\r\n}\r\n\r\nexport default AuthContext;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}